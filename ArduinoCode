#include <Servo.h>
#include <OneWire.h>
#include <DS18B20.h>

#define ONEWIRE_PIN 2
byte address[8] = {0x28, 0xB1, 0x6D, 0xA1, 0x3, 0x0, 0x0, 0x11};
OneWire onewire(ONEWIRE_PIN);
DS18B20 sensors(&onewire);

int incomingByte = 0; 
Servo myservo;
int pos = 90;

void setup() {

        Serial.begin(115200); 
        delay(5000);
        Serial.write("AT+CIPMUX=1\r\n");
        delay(5000);
        Serial.write("AT+CIPSTART=4,\"TCP\",\"kritsit.ddns.net\",6000\r\n");
        delay(5000);

        myservo.attach(9);
        myservo.write(pos);

	pinMode(8, OUTPUT);
        pinMode(10, OUTPUT);

	sensors.begin();
  	sensors.request(address);
       
}

void loop() {

        if (Serial.available() > 0) {
                incomingByte = Serial.read();
                //Serial.println(incomingByte);
		//asci:
		//97 a
		//98 b
		//35 #
		//36 $
		//37 %
		//38 &
                if(incomingByte==97){
                  digitalWrite(8, HIGH);
                }
                if(incomingByte==98){
                  digitalWrite(8, LOW);
                }

                if(incomingByte==35){
                  pos+=20;
                  myservo.write(pos);
                }

                if(incomingByte==36){
                  pos-=20;
                  myservo.write(pos);
                }

                if(incomingByte==37){
                    unsigned char i, j ;// define variables
                    for (i = 0; i <80; i++) // Wen a frequency sound
                      {
                        digitalWrite (10, HIGH) ;// send voice
                        delay (1) ;// Delay 1ms
                        digitalWrite (10, LOW) ;// do not send voice
                        delay (1) ;// delay ms
                      }
                      for (i = 0; i <100; i++) // Wen Qie out another frequency sound
                      {
                        digitalWrite (10, HIGH) ;// send voice
                        delay (2) ;// delay 2ms
                        digitalWrite (10, LOW) ;// do not send voice
                        delay (2) ;// delay 2ms
                      }
                    
                }

		if(incomingByte==38)
		sensors.request(address);
		if (sensors.available()){
   			float temperature = sensors.readTemperature(address);

			Serial.write("AT+CIPSEND=4,9\r\n");
			Serial.write("T:"+temperature+"\r\n");

       			delay(2000);
						 
       		}

}
